{"version":3,"sources":["webpack:///src/components/Map/AppraisalAnalysisSidebar/MarketComparison/ComparativeCaseFilter/ComparativeCaseFilter.vue","webpack:///./src/components/Map/AppraisalAnalysisSidebar/MarketComparison/ComparativeCaseFilter/ComparativeCaseFilter.vue?89b6","webpack:///./src/components/Map/AppraisalAnalysisSidebar/MarketComparison/ComparativeCaseFilter/ComparativeCaseFilter.vue"],"names":["_ref3","_ref2","_ref","ComparativeCaseFilter","name","components","StepOne","asyncToGenerator_default","regenerator_default","a","mark","_callee","wrap","_context","prev","next","__webpack_require__","e","then","bind","abrupt","sent","stop","_this","apply","this","arguments","StepTwo","_callee2","_context2","FilterResultCard","_callee3","_context3","data","targetedLatlng","undefined","bufferGraphic","mappedLayers","serials","asyncSerials","params","filterResults","mounted","beforeDestroy","methods","handleSerialsQuery","_this2","_callee4","layers","_context4","extends_default","createBufferGraphic","distance","api","Estimate","getComparativeCases","console","log","hightlightMatchSerialsPoints","map","layer","properties","_this3","length","viewer","global","VPMC","forEach","removeLayer","serial","_projector","Object","projector","x","coordinateY","y","coordinateX","_projector2","slicedToArray_default","marker","leaflet_src","on","ev","target","openPopup","closePopup","bindPopup","Math","floor","unitPrice","push","addLayer","handleStramingUpdate","points","_this4","_callee5","_context5","handleLatlngQuery","latlng","_this5","_callee6","_context6","_this6","_callee7","buffer","_context7","asyncViewer","radius","weight","fillColor","dashArray","ComparativeCaseFilter_ComparativeCaseFilter","render","_h","$createElement","_c","_self","submit","_v","staticClass","_l","item","index","key","attrs","manageName","type","buildingState","unitNumber","year","completionDate","totalPrice","staticRenderFns","Component","normalizeComponent","__webpack_exports__"],"mappings":"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","file":"static/js/32.3e471b891ecdd8916310.js","sourcesContent":["<template>\r\n  <div>\r\n    <StepOne @submit=\"handleLatlngQuery\"></StepOne>\r\n    <StepTwo @submit=\"handleSerialsQuery\"></StepTwo>\r\n    <div class=\"filterResults\">\r\n      <FilterResultCard\r\n        v-for=\"(item, index) in filterResults\"\r\n        :key=\"index\"\r\n        :name=\"item.manageName\"\r\n        :type=\"item.buildingState\"\r\n        :unitNumber=\"item.unitNumber\"\r\n        :year=\"item.completionDate\"\r\n        :totalPrice=\"item.totalPrice\"\r\n        :unitPrice=\"item.unitPrice\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { Circle, Icon, latLng, LatLng, Marker } from \"leaflet\";\r\nimport api from \"../../../../../api\";\r\nimport Global from \"../../.././../../global\";\r\nimport projector, { EPSG } from \"../../../../../VPMC/module/projector\";\r\nexport default {\r\n  name: \"ComparativeCaseFilter\",\r\n  components: {\r\n    StepOne: async () => await import(\"./StepOne.vue\"),\r\n    StepTwo: async () => await import(\"./StepTwo.vue\"),\r\n    FilterResultCard: async () => await import(\"./FilterResultCard.vue\"),\r\n  },\r\n  data() {\r\n    return {\r\n      targetedLatlng: undefined,\r\n      bufferGraphic: undefined,\r\n      mappedLayers: [],\r\n      serials: [],\r\n      asyncSerials: undefined,\r\n      params: {},\r\n      filterResults: [],\r\n    };\r\n  },\r\n  mounted() {\r\n    // Global.VPMC.transactionDataStreaming.updateEvent.addEventListener(this.handleStramingUpdate)\r\n  },\r\n  beforeDestroy() {\r\n    // Global.VPMC.transactionDataStreaming.updateEvent.removeEventListener(this.handleStramingUpdate)\r\n  },\r\n  methods: {\r\n    async handleSerialsQuery(params) {\r\n      this.params = { ...params };\r\n      this.createBufferGraphic(this.targetedLatlng, params.distance);\r\n      this.asyncSerials = api.Estimate.getComparativeCases(params);\r\n      this.serials = await this.asyncSerials;\r\n      console.log(this.serials);\r\n      const layers = this.hightlightMatchSerialsPoints(this.serials);\r\n      this.filterResults = layers.map((layer) => layer.properties || {});\r\n      console.log(this.filterResults);\r\n    },\r\n    hightlightMatchSerialsPoints(serials = []) {\r\n      const viewer = Global.VPMC.viewer;\r\n      this.mappedLayers.forEach((layer) => viewer.removeLayer(layer));\r\n      serials.forEach((serial) => {\r\n        const [x, y] = projector(EPSG[3826], EPSG[4326], {\r\n          x: serial.coordinateY,\r\n          y: serial.coordinateX,\r\n        });\r\n        const marker = new Marker(latLng(y, x));\r\n        marker.on(\"mouseover\", function (ev) {\r\n          ev.target.openPopup();\r\n        });\r\n\r\n        marker.on(\"mouseout\", function (ev) {\r\n          ev.target.closePopup();\r\n        });\r\n        marker.properties = { ...serial };\r\n        // const content = Object.keys(serial).map(\r\n        //   (key) => `<div>${key}: ${serial[key]}</div>`\r\n        // );\r\n        marker.bindPopup(`\r\n                <div>\r\n                    ${\r\n                      Math.floor(\r\n                        ((marker.properties.unitPrice * 3.3) / 10000) * 100\r\n                      ) / 100\r\n                    }萬/坪\r\n                </div>\r\n                `);\r\n        this.mappedLayers.push(marker);\r\n        viewer.addLayer(marker);\r\n      });\r\n      return this.mappedLayers;\r\n      // const points = Global.VPMC.transactionDataStreaming.pointCluster.getLayers()\r\n      // this.mappedLayers = serials.map(serial => points.find(e => e.properties.id === serial.id))\r\n      // .filter(layer => layer !== undefined && layer.getLatLng().distanceTo(this.targetedLatlng) <= this.params.distance)\r\n\r\n      // this.mappedLayers.forEach(layer => layer.setStyle({\r\n      //     color: 'red'\r\n      // }))\r\n      // return this.mappedLayers\r\n    },\r\n    async handleStramingUpdate(points) {\r\n      const layers = this.hightlightMatchSerialsPoints(this.serials || []);\r\n      this.filterResults = layers.map((layer) => layer.properties || {});\r\n    },\r\n    /**\r\n     * @param {LatLng} latlng\r\n     */\r\n    async handleLatlngQuery(latlng) {\r\n      this.targetedLatlng = latlng;\r\n    },\r\n    async createBufferGraphic(latlng, distance) {\r\n      const viewer = await Global.VPMC.asyncViewer;\r\n      if (this.bufferGraphic) {\r\n        viewer.removeLayer(this.bufferGraphic);\r\n        this.bufferGraphic = undefined;\r\n      }\r\n      const buffer = new Circle(latlng, {\r\n        radius: distance,\r\n        weight: 1.5,\r\n        fillColor: \"#03fcf8\",\r\n        dashArray: \"2, 2\",\r\n      });\r\n      this.bufferGraphic = buffer;\r\n      viewer.addLayer(buffer);\r\n    },\r\n  },\r\n};\r\n</script>\n\n\n// WEBPACK FOOTER //\n// src/components/Map/AppraisalAnalysisSidebar/MarketComparison/ComparativeCaseFilter/ComparativeCaseFilter.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('StepOne',{on:{\"submit\":_vm.handleLatlngQuery}}),_vm._v(\" \"),_c('StepTwo',{on:{\"submit\":_vm.handleSerialsQuery}}),_vm._v(\" \"),_c('div',{staticClass:\"filterResults\"},_vm._l((_vm.filterResults),function(item,index){return _c('FilterResultCard',{key:index,attrs:{\"name\":item.manageName,\"type\":item.buildingState,\"unitNumber\":item.unitNumber,\"year\":item.completionDate,\"totalPrice\":item.totalPrice,\"unitPrice\":item.unitPrice}})}),1)],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-f9a93400\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/Map/AppraisalAnalysisSidebar/MarketComparison/ComparativeCaseFilter/ComparativeCaseFilter.vue\n// module id = null\n// module chunks = ","var normalizeComponent = require(\"!../../../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ComparativeCaseFilter.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./ComparativeCaseFilter.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-f9a93400\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./ComparativeCaseFilter.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = null\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/Map/AppraisalAnalysisSidebar/MarketComparison/ComparativeCaseFilter/ComparativeCaseFilter.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}